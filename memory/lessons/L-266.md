# L-266: dream.py parser bugs — PRINCIPLES.md and lesson themes both undetected
Session: S183 | Date: 2026-02-27 | Theme: Meta | Status: FIXED

## Finding
dream.py (F125) launched with two parser bugs: (1) `re.match(r'(P-\d+):...')` never fired
because PRINCIPLES.md uses pipe-separated `P-NNN text` not `P-NNN: text` per line; (2)
lesson theme regex only matched `**Theme**: X` — missing pipe-header format `| Theme: X |`.
First run: 0P loaded, 252/256 unthemed. After fix: 166P loaded, 93/260 themed.

## Root cause
Tool was written against an assumed format (P-NNN: on its own line) that didn't match
the actual PRINCIPLES.md block format or the dominant lesson header format (`| Theme: |`).
Lesson theme format evolved after genesis era — new format propagated without updating
all consumers. This is the same structural-propagation gap as L-211 and P-176.

## Fix (2 changes to load_principles, 1 to load_lessons)
1. Skip PRINCIPLES.md header before `## ` (avoids compaction-log P-ID false positives)
2. Split by `" | "` and `\n` rather than per-line regex; use `re.search` not `re.match`
3. Lesson theme: add `\|\s*Theme:\s*([^|\n]+)` fallback regex

## Affected: F125 (dream.py now functional), P-176 (cross-substrate propagation gap)
