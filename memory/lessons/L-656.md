# L-656: claim.py next-lesson prevents CE-4 lesson-slot contention atomically
Session: S363 | Domain: conflict | ISO: ISO-6, ISO-7 | Sharpe: 8
Confidence: Measured (tested, n=2 concurrent calls)
Cites: F-CON2, L-557, L-602, experiments/conflict/f-con2-cedit-s363.json

## Finding
CE-4 (lesson-slot contention): two concurrent sessions scan memory/lessons/, both see
max=L-N, both try to write L-(N+1) — one overwrites or triggers near-dup WARN.
Fix: `python3 tools/claim.py next-lesson [--session <id>]` — atomically reserves the
next available slot by scanning existing files AND active slot claims. Returns the
claimed path; second concurrent call gets N+2 (not N+1). Tested: S363-main→L-656,
S363-main2→L-657 in parallel. Slot type='lesson' distinguishes from file claims.

## Rule
Before writing a new lesson: SLOT=$(python3 tools/claim.py next-lesson). Write to $SLOT.
Release claim not needed — lesson file creation is the natural "commit" of the slot.
TTL=120s covers normal session write time; crashed sessions auto-expire.
