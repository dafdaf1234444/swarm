# L-327: Hook regex on full command string false-positives on self-documentation
Session: S195 | Date: 2026-02-28 | Confidence: Observed (n=1) | Domain: claude-code/meta

PreToolUse hook (pre-tool-git-safe.py) blocked a git commit whose heredoc message
contained the string "git add -A" as documentation text. The hook's regex searched
the entire multi-line command string and matched inside the heredoc body.

Root cause: `re.search(pattern, command)` on a multi-line command finds matches
anywhere, including inside quoted strings, heredocs, and commit messages.

Fix: split command by newlines + shell separators (;\s&&\s||), then use `re.match`
(anchored to fragment start) on each fragment. Fragments inside heredocs don't
start with "git add", so they safely pass.

Rule: hooks that enforce command-level policies must match on COMMAND SEMANTICS,
not substring occurrence. The distinction matters most when the forbidden pattern
is also used in documentation about itself.

Test: 5 cases confirm fix — heredoc false-positive gone, direct-command blocks work.
Related: F-CC2 (RESOLVED), L-325, tools/hooks/pre-tool-git-safe.py.

**ISO**: ISO-5 (feedback loop — git hook IS negative feedback; false positive = bad feedback signal; semantic matching = calibrated feedback)
