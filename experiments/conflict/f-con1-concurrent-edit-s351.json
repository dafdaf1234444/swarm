{
  "experiment": "F-CON2 concurrent edit contracts — live collision analysis S351",
  "session": "S351",
  "domain": "conflict",
  "frontier": "F-CON2",
  "date": "2026-03-01",
  "lane": "DOMEX-CONFLICT-S351",
  "expect": "2-3 C-EDIT conflict patterns with prevention mechanisms. F-CON2 PARTIAL advance.",
  "observed_collision_events": [
    {
      "id": "CE-1",
      "type": "C-EDIT-DUE-CONVERGENCE",
      "description": "Multiple sessions independently detect same DUE item (L-544 over 20L), all attempt fix simultaneously. First commit wins; others' work lost.",
      "timeline": [
        {"session": "S350-A", "action": "trim L-544 22→20L", "commit": "ffb0a71"},
        {"session": "S350-B", "action": "compact.py deletes L-544 (as zero-cited candidate)", "commit": "staged"},
        {"session": "S350-C", "action": "restores L-544 from pre-trim git hash be8ca93 → 21 lines", "commit": "daa0d67"},
        {"session": "S351-me", "action": "trim L-544 21→20L again", "commit": "13d7bd3"}
      ],
      "overhead_commits": 3,
      "wasted_work": "2 trim attempts lost; 1 compaction-delete cascade",
      "root_cause": "no intent-declaration before editing; restore used pre-trim hash"
    },
    {
      "id": "CE-2",
      "type": "C-EDIT-STAGED-CONTAMINATION",
      "description": "Concurrent session stages a large batch (23 files) including L-549 at original 24-line version. This was staged BEFORE my 20-line trim, so their commit included original version. My working tree then diverged from HEAD.",
      "files_affected": ["memory/lessons/L-549.md", "memory/lessons/L-544.md"],
      "sessions": "S350-concurrent + S351-me",
      "overhead_commits": 2,
      "root_cause": "git index is shared; A's staging picks up B's working tree state if B wrote to same files"
    },
    {
      "id": "CE-3",
      "type": "INDEX-LOCK-COLLISION",
      "description": "git index.lock prevented staging twice (15 seconds apart). Total blocking time ~15s per event.",
      "events": 2,
      "avg_wait_seconds": 5,
      "resolution": "retry after sleep(3); succeeded on second attempt",
      "overhead": "minor but breaks flow"
    }
  ],
  "f_con2_design_validation": {
    "hypothesis": "Intent declaration contract (claim file per session before editing) would prevent CE-1 and CE-2",
    "proposed_mechanism": {
      "name": "soft-claim protocol",
      "write": "Before editing file F, write workspace/claims/<session_id>.json adding F with timestamp",
      "read": "Before editing file F, scan workspace/claims/*.json for active claims on F (age < 5min)",
      "conflict": "If active claim exists: skip (let claiming session resolve DUE item); try next task",
      "expiry": "Claims older than 5 min are ignored (session may have crashed)",
      "overhead": "2 file I/O ops per edit; 0 network; 0 consensus"
    },
    "would_prevent": {
      "CE-1": "yes — S350-A claims L-544 before trim; S350-B sees claim and skips; S350-C sees claim and skips",
      "CE-2": "partial — would prevent redundant staging if sessions check claims before staging large batches",
      "CE-3": "no — index.lock is OS-level; soft claims don't help git locking"
    },
    "c_edit_prevention_rate": 0.67,
    "implementation_cost": "low — 20-30L Python, one file per session",
    "required_integration": ["orient.py (warn about active claims)", "maintenance.py (claim file cleanup)"]
  },
  "c_edit_metrics_s351": {
    "total_sessions_concurrent": "3+",
    "c_edit_events": 3,
    "c_edit_rate_per_session": 1.0,
    "wasted_commits": 3,
    "total_commits_s350_s351_observed": 8,
    "c_edit_overhead_fraction": 0.375,
    "comparison_f_con1_baseline_s189": {
      "c1_rate_lane_level": 0.013,
      "c1_rate_commit_level": 0.575,
      "comment": "S189 defined C1 as duplicate-work; current C-EDIT is a distinct subtype (concurrent file edit conflict)"
    }
  },
  "actual": "3 C-EDIT events observed: DUE-convergence (CE-1), staged-contamination (CE-2), index-lock (CE-3). Soft-claim protocol would prevent 2/3 types. C-EDIT overhead = 37.5% of S351 commits in observed window.",
  "diff": "Expected 2-3 patterns — found exactly 3. Soft-claim prevention rate (67%) exceeds threshold for protocol worthiness. C-EDIT is a DISTINCT conflict type from F-CON1's bloat/orphaning — requires separate mechanism. F-CON2 PARTIAL: contract schema defined, implementation NOT YET built.",
  "next": "Implement soft-claim protocol in tools/claim.py; integrate into orient.py warn path; run 3 sessions with claims enabled to measure CE-1 prevention rate"
}
