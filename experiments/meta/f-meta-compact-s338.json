{
  "experiment": "f-meta-compact-s338",
  "frontier": "F-META3",
  "session": "S338",
  "date": "2026-03-01",
  "lane": "DOMEX-META-S338",
  "question": "Which maintenance.py functions/blocks can be removed or compressed to reduce T4 token load by >=2000t?",
  "baseline": {
    "file": "tools/maintenance.py",
    "bytes": 109796,
    "lines": 2364,
    "total_tokens": 27449,
    "check_function_count": 36,
    "helper_function_count": 34,
    "constant_block_tokens": 1582,
    "string_literal_tokens": 7881,
    "string_literal_fraction": 0.293
  },
  "structural_findings": {
    "lane_triple_redundancy": {
      "description": "check_swarm_lanes(2320t), check_swarm_coordinator(714t), check_lane_reporting_quality(1007t) each independently read SWARM-LANES.md, parse with _parse_swarm_lane_rows(), build latest_by_lane dict, filter active. 125t boilerplate x3.",
      "combined_tokens": 4041,
      "duplicated_boilerplate_tokens": 250
    },
    "mission_constraints_bloat": {
      "description": "check_mission_constraints(2514t) is largest function. 9 sub-checks including: runtime re-probe duplicating check_runtime_portability, self-referential maintenance.py read(277t), F119 transition evidence(712t).",
      "combined_tokens_with_helper": 2826
    },
    "runtime_probe_triplication": {
      "description": "check_runtime_portability, check_mission_constraints, and build_inventory all independently probe _python_command_runs/_command_exists/_py_launcher_runs. Same results, never cached.",
      "affected_functions": ["check_runtime_portability", "check_mission_constraints", "build_inventory"]
    },
    "import_fallback_overhead": {
      "description": "Lines 20-49: _load_symbol + inline fallbacks for paper_drift(65t) and parse_active_principle_ids(163t). Both source files exist. Fallback is full regex reimplementation.",
      "tokens": 361
    }
  },
  "identified_removals": [
    {
      "function_name": "_reason_action_evidence_sessions + F119 transition evidence block",
      "lines": "384-422 (helper) + 1808-1868 (caller)",
      "estimated_tokens": 712,
      "reason": "39-line helper + 60-line calling code implements F119-specific stale evidence pattern matching in SESSION-LOG. Fires NOTICE-only, triggers only when python-alias-missing or inter-swarm-tooling-missing. 712t for an infrequent low-severity check. Move to standalone F119 diagnostic tool."
    },
    {
      "function_name": "check_mission_constraints self-referential block",
      "lines": "1869-1898",
      "estimated_tokens": 277,
      "reason": "Reads maintenance.py source at runtime to verify required_checks defs exist and all_checks wiring. Static property — Python import would fail if defs missing. CI/test assertion sufficient."
    },
    {
      "function_name": "check_mission_constraints runtime re-probe",
      "lines": "1779-1807",
      "estimated_tokens": 280,
      "reason": "Re-probes _python_command_runs/_command_exists for python3/python/bash/pwsh — identical to check_runtime_portability called earlier in all_checks. Results immutable within single run."
    },
    {
      "function_name": "parse_active_principle_ids inline fallback",
      "lines": "36-49",
      "estimated_tokens": 163,
      "reason": "Full 11-line regex reimplementation of swarm_parse.active_principle_ids. swarm_parse.py exists. Replace with 2-line stub returning (set(), set()) — principle checks degrade gracefully."
    }
  ],
  "identified_compressions": [
    {
      "function_name": "Lane triple (check_swarm_lanes + check_swarm_coordinator + check_lane_reporting_quality)",
      "current_tokens": 4041,
      "projected_tokens": 3200,
      "savings": 841,
      "strategy": "Extract _parsed_active_lanes() shared helper. Eliminate 2 duplicated read/parse/filter passes."
    },
    {
      "function_name": "check_runtime_portability + probe sharing",
      "current_tokens": 1298,
      "projected_tokens": 900,
      "savings": 398,
      "strategy": "Extract _runtime_capabilities() dict. Reuse in check_mission_constraints and build_inventory."
    },
    {
      "function_name": "check_proxy_k_drift",
      "current_tokens": 1620,
      "projected_tokens": 1300,
      "savings": 320,
      "strategy": "Simplify dirty-tree heuristic (5 booleans, multiple branches). Flatten same_dirty_snapshot/likely_dirty_logged/stale_clean_baseline logic. Shorten diagnostic messages."
    },
    {
      "function_name": "Diagnostic message strings (global)",
      "current_tokens": 7881,
      "projected_tokens": 6800,
      "savings": 1081,
      "strategy": "Top 10 messages average 180 chars. Remove inline parenthetical explanations from NOTICEs. Extract repeated command hints to constants. Remove redundant cross-references."
    },
    {
      "function_name": "HIGH_RISK_LANE_PATTERNS constant",
      "current_tokens": 175,
      "projected_tokens": 100,
      "savings": 75,
      "strategy": "Convert 14 separate re.compile() calls to data-driven loop over (pattern_string, label) tuples."
    },
    {
      "function_name": "FILE_REF_ALIAS_MAP constant",
      "current_tokens": 199,
      "projected_tokens": 120,
      "savings": 79,
      "strategy": "Remove identity mappings (SWARM.md->SWARM.md), handle via default fallback. Compress remaining entries."
    }
  ],
  "prior_session_findings": {
    "note": "Concurrent S338 session found: docstring removal(1036t), check_historian_integrity(700t), check_github_swarm_intake(680t), check_dispatch_log(400t), check_utility(180t) as split candidates to tools/check_supplemental.py",
    "complementary": true,
    "split_approach": "T4 tier only measures 4 files. Moving checks to new file shifts tokens out of T4 without losing functionality."
  },
  "summary": {
    "total_removal_savings": 1432,
    "total_compression_savings": 2794,
    "total_estimated_savings": 4226,
    "savings_percentage": "15.4%",
    "projected_final_tokens": 23223,
    "top_3_removals": [
      "_reason_action_evidence_sessions + F119 transition evidence (712t)",
      "check_mission_constraints runtime re-probe (280t)",
      "check_mission_constraints self-referential block (277t)"
    ],
    "top_3_compressions": [
      "Diagnostic message string shortening (1081t)",
      "Lane triple read/parse/filter dedup (841t)",
      "Runtime capability probe extraction (398t)"
    ]
  },
  "recommendation": "Phase 1 (safe, immediate, ~1432t): Remove 4 identified removable blocks. Zero functional loss. Phase 2 (structural, ~1239t): Extract shared helpers (_parsed_active_lanes, _runtime_capabilities). Phase 3 (polish, ~1555t): Compress messages, constants, proxy-K branching. Total achievable: ~4226t (15.4%). Combined with prior session split approach (~1750t to check_supplemental.py), total T4 reduction potential: ~3182t from T4 tier specifically.",
  "risk_assessment": "LOW — Phase 1 removals are provably redundant. Phase 2 preserves all check semantics. Phase 3 shortens messages without losing actionability.",
  "confidence": "MEASURED (full 2364-line analysis, per-function token accounting, overlap graph traced)"
}
